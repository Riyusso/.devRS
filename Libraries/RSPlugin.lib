Properties:
Menu, Tray, Icon, OptionsIcon.ico
return

AssignHotkey:
SplitPath, A_ScriptName,,,, PluginName
IniRead, Hotkey, plugin-settings.ini, %PluginName%, key, UNASSIGNED
If Hotkey=UNASSIGNED
    GoSub ChooseHotkey
else
    Hotkey, %Hotkey%, Function
return

ChooseHotkey:
	width=235
	height=80
	Gui, ChooseHotkey:New, +hwndChooseHotkey
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 07868f
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x07868f, 0x07868f, "White"]
	Opt2 := [ , 0x07868f, 0x01a1ab, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96, Choose your desired hotkey!
	Gui, Add, Hotkey, % "x" Width/10 " y+18 w" (Width/2) " Center vHotkey ",
    Gui, Add, Button, x+12 w70 h25 +default gSubmitButton hwndBut1 +Center, Ready
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*DpiFactor() " h" height*DpiFactor() " r6-6"
	FadeIn(ChooseHotkey)
return
	Gui, Show, w%width% h%height%, Desired hotkey?

SubmitButton:
    Gui, Submit, NoHide
    If (Hotkey!="None" && Hotkey!="" && Hotkey!=UNASSIGNED) {
        FadeOut(ChooseHotkey)
		IniWrite, %Hotkey%, plugin-settings.ini, %PluginName%, key
        GoSub AssignHotkey
    }
    else
        RSNotify("Not possible")
return

ChooseHotkeyGuiEscape:
	FileDelete, %A_ScriptFullPath%
    FadeOut(ChooseHotkey)
	RSNotify("Canceled")
	Sleep 1500
    ExitApp
return

#Include Libraries\Functions.lib
#Include Libraries\RSNotify.lib
#Include Libraries\Library.lib