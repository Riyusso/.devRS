settings: ;settings

	Width := 280
	labelsx := (Width/7)
	inputw := (Width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18
	
	IniRead, LockPw, settings.ini, settings, LockPw
	IniRead, seconds, settings.ini, settings, seconds
	IniRead, BreakLoop, settings.ini, settings, BreakLoop
	IniRead, email, settings.ini, settings, email
	IniRead, passwordhash, settings.ini, settings, passwordhash
	password:=Crypt.Encrypt.StrDecrypt(passwordhash,"KktgC3l0wR",7,3)

	If BreakLoop=1
	ChooseBL=1
	Else
	ChooseBL=2
	
	Gui, settings:New, +hwndScriptOptions
	Gui, +LastFound 
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y8 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Script Options
	
		Gui, Color, 008383, 333333
		Gui, Font, s9 
		Gui, Font, normal		

	Gui, Add, Text, % "x" labelsx " y+18", Start with Windows
	Gui, Add, DropDownList, % "x" Width-105 " w75 y40 Center vStartWithWindows 0x200 Choose" StartWithWindows " AltSubmit" , No|Yes
	
	Gui, Add, Text, % "x" labelsx " y+13", RS-Guard
	Gui, Add, DropDownList, % "x" Width-105 " w75 y71 Center 0x200 vBreakLoop Choose" ChooseBL " AltSubmit" , Enabled|Disabled
	
	Gui, Add, Text, % "x" labelsx " y+17", Email:
	Gui, Add, Edit, % "x+38 w" inputw " h15 hwndEdit6 vemail -E0x200 +Center -VScroll", %email%
		
	Gui, Add, Text, % "x" labelsx " y+8", Password:
	Gui, Add, Edit, % "x+17 w" inputw " h15 hwndEdit7 vpassword +password -E0x200 +Center -VScroll", %password%
	
	Gui, Add, Text, % "x" labelsx " y+8", Lock Password:
	Gui, Add, Edit, % "x+" lpwpos+7 " w" lpwwidth " h15 hwndEdit8 vLockPw +password -E0x200 +Center -VScroll", %LockPw%
	
	
	Gui, Font, s10 w600
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+14 w" (Width*0.80) " gProtectionSettings h37 hwndBut2 +Center", RS-Guard 
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+0 w" (Width*0.80) " h37 gMoreSettingsLabel hwndBut2 +Center", More Settings
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+0 w" (Width*0.80) " h37 gmnuUninstall hwndBut2 +Center", Uninstall
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Font, s9
	Gui, Font, normal
	
	Gui, Font, s10 cFFFFFF Bold
	Gui, Add, Button, % "x" (Width/2)-(((Width*0.30)*2)/2)-2 " y+15 w" (Width*0.30) " gbutton hwndBut1 +Center +Default", Apply
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+5 w" (Width*0.30) " gdestroy hwndButt2 +Center",Cancel
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Text, % "x+1 h42 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r6-6
	Gui, Show, % "w" Width , Script Options
	FadeIn(ScriptOptions)
return

button:
	Gui, Submit, NoHide
	
	If LockPw is not digit
	{
	GoSub WarningGUI
	return
	}
	
	passwordhash:=Crypt.Encrypt.StrEncrypt(password,"KktgC3l0wR",7,3)
	IniWrite, %passwordhash%, settings.ini, settings, passwordhash
	IniWrite, %BreakLoop%, settings.ini, settings, breakloop
	IniWrite, %email%, settings.ini, settings, email
	IniWrite, %LockPw%, settings.ini, settings, LockPw
	IniWrite, %StartWithWindows%, settings.ini, settings, StartWithWindows
	idleseconds:=1000*(seconds)
	FadeOut(ScriptOptions)
	RSNotify("Settings Applied",105,,,,1)
	If BreakLoop=1
	Gosub Protection
	SplitPath, A_Scriptname, , , , OutNameNoExt 
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk 
	If StartWithWindows=2
	{
	IfNotExist, %LinkFile% 
	FileCreateShortcut, %A_ScriptFullPath%, %LinkFile% 
	Run, %comspec% /c SchTasks /SC ONLOGON /F /Create /TN RSRunScript /RL HIGHEST /TR "%A_ScriptDir%\launcher.exe
	}
	If StartWithWindows=1
	{
	FileDelete, %LinkFile%
	Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript
	}
return

;--------------------------------------------------------------------------------------------------------------

MoreSettingsLabel:
	Width := 280
	labelsx := (Width/7)+30
	inputw := (Width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18
	
	IniRead, TransparentStartMenu, settings.ini, settings, TransparentStartMenu
		
	taskbarsave=%TransparentStartMenu%

	Gui, MoreMenu:New, +hwndMoreHWND
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y8 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", More Settings
		Gui, Color, 008383, 333333
		Gui, Font, s8, Tahoma
		Gui, Font, normal
		
	Gui, Add, Text, % "x90 y+25", Taskbar Transparency: 
	Gui, Add, Slider, % "x55 w180 h45 Range0-255 y+15 hwndEdit8 vTransparentStartMenu gTaskbarSet Thick19 -Theme +Center", %TransparentStartMenu%
		
	Gui, Font, s10 cFFFFFF Bold
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	Gui, Add, Button, % "x88 y+8 w55 gmorebutton hwndBut1 +Center +Default", Apply
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+5 w55 gmoreclose hwndButt2 +Center",Cancel
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x+1 h35 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r6-6
	Gui, Show, w280, More Settings
	FadeIn(MoreHWND)
return

morebutton:
	Gui, Submit, NoHide
	IniWrite, %TransparentStartMenu%, settings.ini, settings, TransparentStartMenu
	FadeOut(MoreHWND)
	RSNotify("Settings Applied",105,,,,1)
return

moreclose:
WinSet, Transparent, %taskbarsave%, ahk_class Shell_TrayWnd
FadeOut(MoreHWND)
return
destroy:
	FadeOut(ScriptOptions)
return

;--------------------------------------------------------------------------------------------------------------

ProtectionSettings:
	IniWrite, %keysvar%, settings.ini, settings, lockkey
	IniRead, lockkey, settings.ini, settings, lockkey
	IniRead, BreakLoop, settings.ini, settings, BreakLoop
	IniRead, seconds, settings.ini, settings, seconds
	IniRead, ClockWanted, settings.ini, settings, ClockWanted
	IniRead, AfterFS, settings.ini, settings, AfterFS
	IniRead, LockPw, settings.ini, settings, LockPw
	IniRead, logging, settings.ini, settings, LoggingLockTimes
	keys=None|Esc|Del|Ins|Home|Up|Down|Left|Right|ScrollLock|PrintScreen|Pause|AppsKey|NumLock|Numpad0|Numpad1|Numpad2|Numpad3|Numpad4|Numpad5|Numpad6|Numpad7|Numpad8|Numpad9|NumpadDot|NumpadDiv|NumpadMult|NumpadAdd|NumpadSub|NumpadEnter|NumpadIns|NumpadEnd|NumpadDown|NumpadPgDn|NumpadLeft|NumpadClear|NumpadRight|NumpadHome|NumpadUp|NumpadPgUp|NumpadDel|Media_Next|Media_Play_Pause|Media_Prev|Media_Stop|Volume_Down|Volume_Up|Volume_Mute|Browser_Back|Browser_Favorites|Browser_Home|Browser_Refresh|Browser_Search|Browser_Stop|Launch_App1|Launch_App2|Launch_Mail|Launch_Media|F2|F3|F4|F5|F6|F11|F12|F13|F14|F15|F16|F17|F18|F19|F20|F21|F22|1|2|3|4|5|6|7|8|9|0|a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|x|y|z
	Loop,Parse,keys, `|
	{
		if lockkey=%A_LoopField%
		selectkey=%A_Index%
	}
	
	If BreakLoop=1
	ChooseBL=1
	Else
	ChooseBL=2
	
	Width := 295
	Gui, ProtectionMenu:New, +hwndProtectionSettings
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Color, 808080
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y8 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Protection Settings
		Gui, Color, 008383, 333333
		Gui, Font, s8, Tahoma
		Gui, Font, normal
	Gui, Add, Text, % "x8 y+25 w147 Center", Computer ›
	
	Gui, Add, DropDownList, % "x+8 w87 Center vBreakLoop Choose" ChooseBL " AltSubmit" , Protected|Unprotected

	Gui, Add, Text, % "x8 y+13 w147 Center", Lock Password › 
	Gui, Add, Edit, % "x+8 w87 h15 vLockPw hwndEdit8 +password -E0x200 +Center -VScroll", %LockPw%

	Gui, Add, Text, % "x8 y+14 w147 Center", Lock After Full Screen ›
	Gui, Add, DropDownList, % "x+8 w87 Center vAfterFS Choose" AfterFS " AltSubmit" , On|Off

	Gui, Add, Text, % "x8 y+14 w147 Center", Security Logs ›
	Gui, Add, DropDownList, % "x+8 w87 Center vlogging Choose" logging " AltSubmit" , On|Off

	Gui, Add, Text, % "x8 y+18 w147 Center", Clock › 
	Gui, Add, DropDownList, % "x+8 w87 Center vClockWanted Choose" ClockWanted " AltSubmit" , On|Off
	Gui, Add, Text, % "x8 y+14 w147 Center", Key ›
	Gui, Add, DropDownList, % "x+8 w87 Center vKeysVar Choose" selectkey "" , None|Esc|Del|Ins|Home|Up|Down|Left|Right|ScrollLock|PrintScreen|Pause|AppsKey|NumLock|Numpad0|Numpad1|Numpad2|Numpad3|Numpad4|Numpad5|Numpad6|Numpad7|Numpad8|Numpad9|NumpadDot|NumpadDiv|NumpadMult|NumpadAdd|NumpadSub|NumpadEnter|NumpadIns|NumpadEnd|NumpadDown|NumpadPgDn|NumpadLeft|NumpadClear|NumpadRight|NumpadHome|NumpadUp|NumpadPgUp|NumpadDel|Media_Next|Media_Play_Pause|Media_Prev|Media_Stop|Volume_Down|Volume_Up|Volume_Mute|Browser_Back|Browser_Favorites|Browser_Home|Browser_Refresh|Browser_Search|Browser_Stop|Launch_App1|Launch_App2|Launch_Mail|Launch_Media|F2|F3|F4|F5|F6|F11|F12|F13|F14|F15|F16|F17|F18|F19|F20|F21|F22|1|2|3|4|5|6|7|8|9|0|a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|x|y|z
	Gui, Font, s10 cFFFFFF Bold
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.64)/2) " y+9 w" (Width*0.64) " h37 gPrInfo hwndBut2 +Center", Info
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)

	Gui, Add, Button, % "x" (Width/2)-((Width*0.64)/2) " y+9 w" (Width*0.64) " h37 gSecurityLoggingLabel hwndBut3 +Center", Show Logs
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x88 y+10 w55 gprotectionbutton hwndBut1 +Center +Default", Apply
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+5 w55 gdestroyprot hwndButt2 +Center",Cancel
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r6-6
	Gui, Show, % "w295" , RS-Guard Settings
	FadeIn(ProtectionSettings)
return

destroyprot:
FadeOut(ProtectionSettings)
return

protectionbutton:
	Gui, Submit, NoHide
	IniWrite, %KeysVar%, settings.ini, settings, lockkey
	IniWrite, %BreakLoop%, settings.ini, settings, breakloop
	IniWrite, %ClockWanted%, settings.ini, settings, ClockWanted
	IniWrite, %LockPw%, settings.ini, settings, LockPw
	IniWrite, %AfterFS%, settings.ini, settings, AfterFS
	IniWrite, %logging%, settings.ini, settings, LoggingLockTimes
	idleseconds:=1000*(seconds)
	FadeOut(ProtectionSettings)
	if seconds is number
	{
	RSNotify("Settings Applied",105,,,,1)
	IniWrite, %seconds%, settings.ini, settings, seconds
	}
	else
	{
	RSNotify("Invalid period")
	seconds=0
	IniWrite, %seconds%, settings.ini, settings, seconds
	}
	If BreakLoop=1
	Gosub Protection
	If (lockkey!="None" && lockkey!="" and lockkey!=keysvar)
	Hotkey, %lockkey%, Off
	GoSub LockLabel
return

;--------------------------------------------------------------------------------------------------------------

ScriptFunctions:
		Width := 300
		Gui, Functions:New, +hwndSFunctions
		Gui, +LastFound
		WinSet, Transparent, 210
		Gui, Color, 008383
		Gui, Margin, 0, 0
		Gui, Font, s11 cD0D0D0 Bold
		Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h66 Background1F2326 Disabled hwndHPROG"
		Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
		Gui, Add, Text, % "x0 y0 w" Width " h30 BackgroundTrans Center 0x200 gGuiMove vCaption", Functions
		Gui, Font, s8 c228a96, Tahoma
		Gui, Add, Text, % "x-2 y+2 w" (Width) " Center BackgroundTrans", The Lock key is configurable
		Gui, Add, Text, % "x-2 y+2 w" (Width) " Center BackgroundTrans", Check RS-Guard Options
		Gui, Font, s10 cD0D0D0, Tahoma
		Gui, Add, Text, % "x-2 y+10 w" (Width-(Width*0.47)) " Center BackgroundTrans", Function
		Gui, Add, Text, % "x+52 w30 Center BackgroundTrans", Keys
		Gui, Font, s8 cD0D0D0, Tahoma
		Gui, Add, Text, % "x0 y+12 w" (Width/2) " Center ", Lock:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", %keysvar%

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Volume Control:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", Scroll Over Tray

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Minimize Current App:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center",  Alt x 2
		
		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Show Desktop:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center",  Alt x 3
		
		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", RS-Guard Toggle:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F1

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Speed Dial
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F4

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Play/Pause:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F8

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Stop:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F8 x 2

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Previous:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F9

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Next:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", F10

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Volume Up:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", Page Up

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Volume Down:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", Page Down

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Input Email:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", CapsLock x 2

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Input Password:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", Win + CapsLock x 2		

		Gui, Add, Text, % "x0 y+8 w" (Width/2) " Center ", Reload Script:
		Gui, Add, Text, % "x+1 w" (Width/2) " Center", Win+ Alt + R

		Gui, Font, s10 cFFFFFF Bold
		Opt1 := [6, 0x008383, 0x008383, 0xEEEEEE]
		Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
		Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
			
		Gui, Add, Button, % "x" (Width/2)-((Width*0.64)/2) " y+12 w" (Width*0.64) " h37 gPrInfo hwndBut2 +Center", RS-Guard Info
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)

		Gui, Add, Button, % "x" (Width/2)-((Width*0.35)/2) " w" (Width*0.35) " y+12 gsubit +hwndButton2 +Default", Exit
		ImageButton.Create(Button2, Opt1, Opt2, "", Opt4)
			
		Gui, Add, Text, % "x7 y+2 w" (Width-14) "h2 vP"
		GuiControlGet, P, Pos
		H := PY + PH
		H:=H*dpi
		Width:=Width*dpi
		Gui, -Caption
		WinSet, Region, 0-0 w%Width% h%H% r6-6
		Gui, Show, % "w" Width " NA", Functions
		FadeIn(SFunctions)
return

subit:
FadeOut(SFunctions)
 	Gui, Submit, NoHide
return
;--------------------------------------------------------------------------------------------------------------

SettingsWndFirst:
	GoSub Initiation
	
	Width := 280
	labelsx := (Width/7)
	inputw := (Width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18	
	If BreakLoop=1
	ChooseBL=1
	Else
	ChooseBL=2
	
	Gui, SettingsWndFirst:New, +hwndScriptOptionsFirst
	Gui, +LastFound 
	WinSet, Transparent, 0
	Gui, Color, 808080
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y8 w188 r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Script Options
	
		Gui, Color, 008383, 333333
		Gui, Font, s9 
		Gui, Font, normal		
		
	Gui, Add, Text, % "x" labelsx " y+18", Start with Windows
	Gui, Add, DropDownList, % "x" Width-105 " w75 y40 Center vStartWithWindows 0x200 Choose" StartWithWindows " AltSubmit" , No|Yes
	
	Gui, Add, Text, % "x" labelsx " y+13", RS-Guard
	Gui, Add, DropDownList, % "x" Width-105 " w75 y71 Center 0x200 Choose" ChooseBL " AltSubmit" , Enabled|Disabled
	
	Gui, Add, Text, % "x" labelsx " y+17", Email:
	Gui, Add, Edit, % "x+38 w" inputw " h15 hwndEdit6 vemail -E0x200 +Center -VScroll", %email%
		
	Gui, Add, Text, % "x" labelsx " y+8", Password:
	Gui, Add, Edit, % "x+17 w" inputw " h15 hwndEdit7 vpassword +password -E0x200 +Center -VScroll", %password%
	
	Gui, Add, Text, % "x" labelsx " y+8", Lock Password:
	Gui, Add, Edit, % "x+" lpwpos+7 " w" lpwwidth " h15 hwndEdit8 vLockPw +password -E0x200 +Center -VScroll", %LockPw%
	
	Gui, Font, s10 w600
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+14 w" (Width*0.80) " gProtectionSettings h37 hwndBut2 +Center", RS-Guard
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+0 w" (Width*0.80) " h37 gMoreSettingsLabel hwndBut2 +Center", More Settings
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x" (Width/2)-((Width*0.80)/2) " y+0 w" (Width*0.80) " h37 gmnuUninstall hwndBut2 +Center", Uninstall
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Font, s9
	Gui, Font, normal
	
	Gui, Font, s10 cFFFFFF Bold
	Gui, Add, Button, % "x" (Width/2)-(((Width*0.30)*2)/2)-2 " y+15 w" (Width*0.30) " gbuttonfirst hwndBut1 +Center +Default", Apply
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+5 w" (Width*0.30) " gdestroyfirst hwndButt2 +Center",Cancel
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x+1 h42 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r6-6
	Gui, Show, % "w" Width , Menu
	FadeIn(ScriptOptionsFirst)
return

buttonfirst:
	Gui, Submit, NoHide
	
	If LockPw is not digit
	{
	GoSub WarningGUI
	return
	}
	
	passwordhash:=Crypt.Encrypt.StrEncrypt(password,"KktgC3l0wR",7,3)
	SplitPath, A_Scriptname, , , , OutNameNoExt 
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk 
	
	If StartWithWindows=2
	{
	IfNotExist, %LinkFile% 
	FileCreateShortcut, %A_ScriptFullPath%, %LinkFile% 
	IniWrite, 1, settings.ini, settings, CreateATask
	}
	If StartWithWindows=1
	{
	FileDelete, %LinkFile%
	}
	
	IniWrite, %seconds%, settings.ini, settings, seconds
	IniWrite, %BreakLoop%, settings.ini, settings, breakloop
	IniWrite, %email%, settings.ini, settings, email
	IniWrite, %passwordhash%, settings.ini, settings, passwordhash
	IniWrite, %LockPw%, settings.ini, settings, LockPw
	IniWrite, %StartWithWindows%, settings.ini, settings, StartWithWindows
	idleseconds:=1000*(seconds)
	FadeOut(ScriptOptionsFirst)
	SetTimer, ARun, -1600
return

destroyfirst:
	Gui, Submit, NoHide
	FadeOut(ScriptOptionsFirst)
	RSNotify("Careful, no settings!", 130,,,,1)
	SetTimer, ARun, -1600
return

;--------------------------------------------------------------------------------------------------------------

MenuInit:
IfExist RSIcon.ico
Menu, TRAY, Icon, RSIcon.ico
Menu, Tray, NoStandard
Menu, Tray, ADD, Menu , DefaultMenu
Menu, Tray, Default, Menu
Menu Tray, Click, 1           ; Enable single click action on tray
Return 

mnuScriptReload:
	Reload
Return

mnuUninstall:
	FadeOut(ScriptOptionsFirst)
	FadeOut(DefaultHWND)
	FadeOut(ScriptOptions)
	RSNotify("Uninstalling", 130)
	Sleep 2000	
	files=build.ini,launcher.exe,RS.png,rsanimation.mp4,RSIcon.ico,RSStopped.ico,segoeui.ttf,settings.ini,log.txt
	Loop, Parse, files, `,
	FileDelete, % A_MyDocuments "\" ScriptName "\" A_LoopField
	SplitPath, A_Scriptname, , , , OutNameNoExt 
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk 
	FileDelete, %LinkFile%
	Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript
	IfNotExist, Base\uninstaller.exe
	FileInstall, Base\uninstaller.exe, %A_Temp%\uninstaller.exe, 1
	Run, %A_Temp%\uninstaller.exe
	ExitApp
return

mnuExit:
	FadeOut(DefaultHWND)
	GoSub RSRunScript
	sleep 1200
	SetTimer,ExitAppL, 1300
Return

ExitAppL:
	ExitApp
return

DefaultMenu:
	FadeOut(DefaultHWND)
	Gui, DefaultMenu:New, +hwndDefaultHWND
	Gui, +LastFound +AlwaysOnTop -Caption +ToolWindow
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font,  cFFFFFF Bold, Segoe UI
	Gui, Color, 232323
	
	If (A_ScreenWidth<2000){
		amultiplier=1
		zfont=13
	}
	If (A_ScreenWidth<1800){
		amultiplier=1
		zfont=12
	}
	If (A_ScreenWidth<1600){
		amultiplier=0.92
		zfont=11
	}
	If (A_ScreenWidth<1400){
		amultiplier=0.87
		zfont=11
	}
	If (A_ScreenWidth<1050){
		amultiplier=0.80
		zfont=10
	}
	
	Gui, Font, s%zfont% cFFFFFF Bold q5
		guiw:=800*amultiplier
		guih:=56*amultiplier
		buth:=(guih)+2
		butw:=((guiw-30)/7)
		guipos:=A_ScreenHeight-164
	
	Opt1 := [6, 0x232323, 0x232323, "White"]
	Opt2 := [ , 0x272727, 0x262626, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	Gui, Add, Button, % "x0 y-2 h" buth " w" butw+9 " gProtect hwndBut1 +Center", RS-Guard
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w" butw " gSuspendScriptToggle hwndBut2 +Center", Suspend
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w" butw " gmnuScriptReload hwndBut4 +Center", Reload
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w" butw " gLockNow hwndBut3 +Center",  Lock
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)	
	
	Gui, Add, Button, % "x+0 h" buth " w" butw+7 " gScriptFunctions hwndBut4 +Center", Controls
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w" butw " gsettings hwndBut4 +Center", Settings
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w" butw-37 " gmnuExit hwndBut3 +Center",  Quit
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, % "x+0 h" buth " w53 gExitDefMenu hwndBut4 ", ×
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	guiw:=guiw*dpi
	guih:=guih*dpi
	WinSet, Region, 0-0 w%guiw% h%guih% r50-50, ahk_id %DefaultHWND%
	guiw:=guiw/dpi
	guih:=guih/dpi
	Gui, Show, h%guih% w%guiw% y%guipos%, Menu
	FadeIn(DefaultHWND)
	DefaultFader:=true
Return

ExitDefMenu:
FadeOut(DefaultHWND)
DefaultFader:=false
return


;--------------------------------------------------------------------------------------------------------------

SecurityLoggingLabel:
Array := Object()
Loop, Read, log.txt ; This loop retrieves each line from the file, one at a time.
{
    Array.Insert(A_LoopReadLine) 
}
elcount:=Array.MaxIndex() ; get the count of the lines in the log file
calccount:=elcount-20 ; get the index of the last 20

Width :=330
Gui, SecLogs:New, +hwndSecLogs
Gui, +LastFound +ToolWindow
WinSet, Transparent, 0
Gui, Color, 2e2e2e
Gui, Margin, 0, 0
Gui, Font, s11 cFFFFFF Bold, Tahoma
Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background2e2e2e Disabled hwndHPROG"
Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP

	Loop, 20 
	{
		element:=Array[calccount+A_Index]
		if(A_Index=1 and element="")
		continue
		Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", %element%
	}

	Gui, Color, 2e2e2e
	Gui, Font, s11 cFFFFFF Bold, Tahoma

	Gui, Add, Button, % "x" (Width/2)-((Width*0.64)/2) " y+22 w" (Width*0.64) " gdestroySecLogs hwndButt2 +Center +Default", Close
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r12-12
	Gui, Show, % "w" Width  , Security Logs
	FadeIn(SecLogs)
return

destroySecLogs:
FadeOut(SecLogs)
return

;--------------------------------------------------------------------------------------------------------------

WarningGUI:
	Width :=210
	Gui, WarningGUI:New, +hwndWarningGUI
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s8 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background2e2e2e Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y28 w" Width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", Password needs to be a number.
	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r12-12
	Gui, Show, % "w" Width  , Warning
	FadeIn(WarningGUI)
	SetTimer, FadeOutWarning, -1800
return
 
FadeOutWarning:
	FadeOut(WarningGUI)
return

;--------------------------------------------------------------------------------------------------------------

PrInfo:
	Width :=330
	Gui, PrInfo:New, +hwndPrInfo
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (Width+2) " h31 Background2e2e2e Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, % "x0 y16 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", RS-Guard is designed to protect your PC.
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", It is going to lock the computer after 
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", the amount of time you have set.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  --- How to use it ---
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Set a password.
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Wait or press the lock button.
			Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", --- Requirements ---
		Gui, Font, s9 cFFFFFF Bold, Tahoma		
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", The password needs to be a number. 
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", You MUST set seconds and a password.
			Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" Width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  --- What some settings do ---
	Gui, Add, Text, % "x0 y+10 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Protected/Unprotected Dropdown -
			Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0",  Toggles whether RS-Guard will lock the PC
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", after the amount of time or not.
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", You can still lock it with the select key
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", Note that the F1 button toggles this function.
			Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+10 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Lock After Full Screen -
			Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", This option controls whether the PC
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", will lock itself after you exit full screen. 
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", This is useful when you are watching a movie.
			Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+10 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Clock -
			Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", Controls whether a clock is displayed
	Gui, Add, Text, % "x0 y+4 w" Width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", on the lock screen. 

		Gui, Color, 2e2e2e
		Gui, Font, s11 cFFFFFF Bold, Tahoma

	Gui, Add, Button, % "x" (Width/2)-((Width*0.64)/2) " y+18 w" (Width*0.64) " gdestroyPrInfo hwndButt2 +Center +Default", Got it
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	H:=H*dpi
	Width:=Width*dpi
	Gui, -Caption
	WinSet, Region, 0-0 w%Width% h%H% r12-12
	Gui, Show, % "w" Width  , RS-Guard Settings
	FadeIn(PrInfo)
	
return

destroyPrInfo:
	FadeOut(PrInfo)
return

;--------------------------------------------------------------------------------------------------------------

AdminPrompt:
	Gui, AdminPrompt:New, +hwndAdminPrompt
	Gui, +LastFound 
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 008383
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w135 h26 Background1F2326 Disabled hwndHPROG"
	Control, ExStyle, -0x20000, , ahk_id %HPROG% ; propably only needed on Win XP
	Gui, Add, Text, x0 y4 w135 Center BackgroundTrans +0x200 c228a96, Are you an admin?
	Gui, Add, Button, x8 y30 w55 +default gRunAsAdmin hwndBut1 +Center, Yeah
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Gui, Add, Button, x71 y30 w55 gNotAnAdmin hwndButt2 +Center,Nope
	ImageButton.Create(Butt2, Opt1, Opt2, "", Opt4)
	
	WinSet, Region, 0-0 w135 h66 r3-3, ahk_id %AdminPrompt%
	Gui, Show, w135 h66 , Are you an admin?
	FadeIn(AdminPrompt)
return

;--------------------------------------------------------------------------------------------------------------
