settings:
	if FirstRun
		GoSub Initiation

	width := 285
	labelsx := (width/8)-3
	inputw := (width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18
	
	Gui, settings:New, +hwndScriptOptions
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y7 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Script Options

		Gui, Color, 008383, 252525
		Gui, Font, s9
		Gui, Font, normal

	Gui, Add, Text, % "x" labelsx " w142 y+25", Start with Windows
	Gui, Add, DropDownList, % "x+0 w75 yp-3 Center vStartWithWindows 0x200 Choose" StartWithWindows " AltSubmit" , No|Yes

	Gui, Add, Text, % "x0 y+14 w" width " Center", Optional:
	Gui, Font, s9 cDFDFDF
	Gui, Add, Text, % "x0 y+3 w" width " Center", (Use keys to output anywhere)
	Gui, Font, s9 cFFFFFF

	Gui, Add, Text, % "x" labelsx " w75 y+12", Email:
	Gui, Add, Edit, % "x+0 yp-1 w" inputw " h16 hwndEdit6 vemail -E0x200 +Center -VScroll", %email%
	SetEditCueBanner(Edit6, "CapsLock x2")
	Gui, Add, Button, % "x+2 yp-1 w21 h17 gSettingsTip1 hwndSettingsTip1 -TabStop +Center", ?
	Gui, Add, Text, % "x" labelsx " w75 y+10", Password:
	Gui, Add, Edit, % "x+0 yp-1 w" inputw " h16 hwndEdit7 vpassword +password -E0x200 +Center -VScroll", %password%
	SetEditCueBanner(Edit7, "Win + CapsLock x2")
	Gui, Add, Button, % "x+2 yp-1 w21 h17 gSettingsTip2 hwndSettingsTip2 -TabStop +Center", ?

	Gui, Font, s10 w600
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+29 w" (width*0.80) " h36 gOtherSettingsLabel hwndBut1 +Center", Other Settings

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+2 w" (width*0.80) " h36 gExtSettings hwndBut2 +Center", Extensions

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+2 w" (width*0.80) " h36 gScriptFunctions hwndBut3 +Center", Features

	Gui, Font, s9
	Gui, Font, normal

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+18 w" (width*0.38) " h30 gbutton hwndBut4 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h30 gdestroyset hwndBut5 +Center", Cancel

	Gui, Add, Text, % "x7 y+12 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But5, Opt1, Opt2, "", Opt4)
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x009494, 0x009494, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(SettingsTip1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(SettingsTip2, Opt1, Opt2, "", Opt4)
	ShAutoComplete(Edit6)
	ShAutoComplete(Edit7)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width, Script Options
	FadeIn(ScriptOptions)
return

button:
	Gui, Submit, NoHide

	passwordhash:=Crypt.Encrypt.StrEncrypt(password,"KktgC3l0wR",7,3)
	IniWrite, %passwordhash%, settings.ini, settings, passwordhash
	IniWrite, %email%, settings.ini, settings, email
	IniWrite, %StartWithWindows%, settings.ini, settings, StartWithWindows
	FadeOut(ScriptOptions)
	RSNotify("Applied")
	SplitPath, A_Scriptname, , , , OutNameNoExt
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk
	StartMenuFile=%A_StartMenu%\Programs\%ScriptName%.lnk
	If StartWithWindows=2
	{
		If A_IsCompiled=1
		{
			MsgBox, %LinkFile% %StartMenuFile%
			IfNotExist, %LinkFile%
				FileCreateShortcut, %A_ScriptFullPath%, %LinkFile%
			IfNotExist, %StartMenuFile%
				FileCreateShortcut, %A_ScriptFullPath%, %StartMenuFile%
			If FirstRun
				IniWrite, 1, settings.ini, settings, CreateATask
			else
				Run, %comspec% /c SchTasks /SC ONLOGON /F /Create /TN RSRunScript /RL HIGHEST /TR "%A_ScriptDir%\launcher.exe, , HIDE
		}
	}
	If StartWithWindows=1
	{
		FileDelete, %LinkFile%
		Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript, , HIDE
	}
	If FirstRun
	{
		IniWrite, 1, settings.ini, settings, AfterInstallation
		SetTimer, ARun, -1600
		FirstRun:=false
	}
return

destroyset:
	If FirstRun
	{
		RSNotify("Careful, no settings!")
		SetTimer, ARun, -1600
	}
	FirstRun:=false
	FadeOut(ScriptOptions)
return

;--------------------------------------------------------------------------------------------------------------

OtherSettingsLabel:
	width := 260
	labelsx := (width/7)+30
	inputw := (width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18

	IniRead, TransparentStartMenu, settings.ini, settings, TransparentStartMenu, 255
	taskbarsave=%TransparentStartMenu%
	SetTimer, KeepTrans, Off

	Gui, OtherMenu:New, +hwndOtherHWND
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y8 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Other Settings

	Gui, Color, 2e2e2e, 333333
	Gui, Font, s8, Tahoma
	Gui, Font, normal

	Gui, Add, Text, % "x0 y+25 w" width " Center", -    Misc    -
	Gui, Add, Text, % "x15 y+14 w120 Center", Start up logo ›
	Gui, Add, DropDownList, % "x+16 w77 yp-3 Center vShowRSRunScript Choose" ShowRSRunScript " AltSubmit" , Yes|No
	Gui, Add, Text, % "x15 y+14 w120 Center", Hotkeys in Fullscreen ›
	Gui, Add, DropDownList, % "x+16 yp-3 w77 Center vhotkeysInFullScreen Choose" hotkeysInFullScreen " AltSubmit" , Yes|No
	Gui, Add, Text, % "x15 y+14 w120 Center", Password expiration ›
	Gui, Add, DropDownList, % "x+16 yp-3 w77 Center vPasswordExpiration Choose" PasswordExpiration " AltSubmit" , Secure|No Expiration|Always ask
	Gui, Add, Button, % "x+2 yp-1 w20 h23 gOtherTip1 hwndOtherTip1 -TabStop +Center", ?

	Gui, Add, Text, % "x0 w" width " y+35 Center", Taskbar Transparency:
	Gui, Add, Slider, % "x40 w" width-80 " h45 Range0-255 y+15 hwndEdit8 vTransparentStartMenu gTaskbarSet Thick19", %TransparentStartMenu%

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+3 w" (width*0.80) " h33 gProtectionSettings hwndBut1 +Center", Protection Settings

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+3 w" (width*0.80) " h33 gUninstallPrompt hwndBut2 +Center", Uninstall

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+10 w" (width*0.38) " h31 gotherbutton hwndBut3 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gotherclose hwndBut4 +Center", Cancel

	Gui, Add, Text, % "x7 y+12 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x3e3e3e, 0x3f3f3f, 0xffffff]
	ImageButton.Create(OtherTip1, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, w%width%, Other Settings
	FadeIn(OtherHWND)
return

otherbutton:
	Gui, Submit, NoHide

	If(TransparentStartMenu<12)
	{
		If !Tried
		{
		Warning:="Careful!"
		Warning2:="The taskbar will be invisible."
		GoSub WarningGUI
		Tried:=true
		return
		}
		else
		{
			Warning:="Don't say I didn't warn you!"
			GoSub WarningGUI
		}
	}

	Tried:=false
	IniWrite, %TransparentStartMenu%, settings.ini, settings, TransparentStartMenu
	IniWrite, %ShowRSRunScript%, settings.ini, settings, ShowRSRunScript
	IniWrite, %hotkeysInFullScreen%, settings.ini, settings, hotkeysInFullScreen
	IniWrite, %PasswordExpiration%, settings.ini, settings, PasswordExpiration
	SetTimer, KeepTrans, 12000

	If hotkeysInFullscreen=2
		SetTimer, HotkeysSuspendCheck, 500

	FadeOut(OtherHWND)
return

otherclose:
WinSet, Transparent, %taskbarsave%, ahk_class Shell_TrayWnd
FadeOut(OtherHWND)
return

;--------------------------------------------------------------------------------------------------------------

ExtSettings:
	width := 255
	labelsx := (width/7)+30
	inputw := (width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18

	Gui, ExtSettings:New, +hwndExtHWND
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y8 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Extensions

	Gui, Color, 2e2e2e, 333333
	Gui, Font, s8, Tahoma
	Gui, Font, normal

	Gui, Add, Text, % "x0 y+25 w" width " Center", -    Built in    -

	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", Fast Search 
	Gui, Add, DropDownList, % "x+20 yp-3 w65 Center vFastSearchWanted Choose" FastSearchWanted " AltSubmit" , Enabled|Disabled
	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", LAlt to Minimize
	Gui, Add, DropDownList, % "x+20 yp-3 w65 Center vAltMinimizeWanted Choose" AltMinimizeWanted " AltSubmit" , Enabled|Disabled
	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", Volume Over Tray
	Gui, Add, DropDownList, % "x+20 yp-3 w65 Center vVolumeOTWanted Choose" VolumeOTWanted " AltSubmit" , Enabled|Disabled

	IfExist, *.ahk
	{
		Gui, Add, Text, % "x0 y+25 w" width " Center", -   Others   -
		Loop, Files, *.ahk
		{
			SplitPath, A_LoopFileLongPath,,,, PluginName

			If RegExMatch(PluginName, "\W")
			{
				PluginName:=StrReplace(PluginName, A_Space, "_")
				PluginName := RegExReplace(PluginName, "\W")
				FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
			}

			IniRead, PluginState, settings.ini, plugins, PluginState%PluginName%, 1
			PluginNameNoUnderscores:=StrReplace(PluginName, "_", A_Space)
			Gui, Add, Text, % "x5 y+14 w" (width/2) " Center", %PluginNameNoUnderscores% ›
			Gui, Add, DropDownList, % "x+20 yp-3 w65 Center vPluginState" PluginName " Choose" PluginState " AltSubmit" , On|Off|Delete
		}
	}

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+18 w" (width*0.80) " h33 gGoToWebsite hwndBut1 +Center", Get More

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+10 w" (width*0.38) " h31 gextbutton hwndBut2 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gextclose hwndBut3 +Center", Cancel

	Gui, Add, Text, % "x7 y+12 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, w%width%, Extensions
	FadeIn(ExtHWND)

return

extbutton:
Gui, Submit, NoHide
IfExist, *.ahk
{
	Loop, Files, *.ahk
	{
		SplitPath, A_LoopFileLongPath,,,, PluginName

		If RegExMatch(PluginName, "\W")
		{
			PluginName:=StrReplace(PluginName, A_Space, "_")
			PluginName := RegExReplace(PluginName, "\W")
			FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
		}

		If % PluginState%PluginName%=1
		{
			IniWrite, % PluginState%PluginName%, settings.ini, plugins, PluginState%PluginName%
			Run, %A_MyDocuments%\%ScriptName%\Extensions %A_MyDocuments%\%ScriptName%\%PluginName%.ahk,,, PID%PluginName% ; PluginID is the PID for the process. Required when you need to close/uninstall the program.
		}
		else if % PluginState%PluginName%=2
		{
			IniWrite, % PluginState%PluginName%, settings.ini, plugins, PluginState%PluginName%
			IfWinExist, % "ahk_pid" PID%PluginName%
				WinKill, % "ahk_pid" PID%PluginName%
		}
		else if % PluginState%PluginName%=3
		{
			IniDelete, settings.ini, plugins, PluginState%PluginName%
			IfWinExist, % "ahk_pid" PID%PluginName%
				WinKill, % "ahk_pid" PID%PluginName%
			FileDelete, %PluginName%.ahk
		}
	}
}
IniWrite, %FastSearchWanted%, settings.ini, settings, FastSearchWanted
IniWrite, %AltMinimizeWanted%, settings.ini, settings, AltMinimizeWanted
IniWrite, %VolumeOTWanted%, settings.ini, settings, VolumeOTWanted

If FastSearchWanted=1
	GuiControl, Functions:, RAltVar, Right Alt
else
	GuiControl, Functions:, RAltVar, Off

If AltMinimizeWanted=1
	GuiControl, Functions:, AltMinimizeVar, Alt x 2
else
	GuiControl, Functions:, AltMinimizeVar, Off

If VolumeOTWanted=1
	GuiControl, Functions:, VolumeOTVar, Scroll Over Tray
else
	GuiControl, Functions:, VolumeOTVar, Off

FadeOut(ExtHWND)
return

extclose:
FadeOut(ExtHWND)
return

;--------------------------------------------------------------------------------------------------------------

ProtectionSettings:
	IniWrite, %assignedKeyLock%, settings.ini, settings, keyLock ; keep these here
	IniRead, keyLock, settings.ini, settings, keyLock, ScrollLock ; keep these here

	If BreakLoop=1
	ChooseBL=1
	Else
	ChooseBL=2

	width := 310
	Gui, ProtectionMenu:New, +hwndProtectionSettings
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Color, 808080
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y8 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Protection Settings
		Gui, Color, 008383, 333333
		Gui, Font, s8, Tahoma
		Gui, Font, normal
	Gui, Add, Text, % "x0 y+25 w" (width/2) " Center", Computer ›

	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vBreakLoop Choose" ChooseBL " AltSubmit" , Protected|Unprotected

	Gui, Add, Text, % "x0 y+20 w" (width/2) " Center", Protection PIN ›
	Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 vNewLockPw hwndEdit8 +password -E0x200 +Center -VScroll +Number", %LockPw%
	Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTip1 hwndProtectionTip1 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+13 w" (width/2) " Center", Seconds until lock ›
	Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 hwndEdit1 vseconds -E0x200 +Center -VScroll +Number", %seconds%
	Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTip2 hwndProtectionTip2 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+13 w" (width/2) " Center", Fullscreen delay ›
	Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 hwndEdit1 vdelayseconds -E0x200 +Center -VScroll +Number", %delayseconds%
	Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTip3 hwndProtectionTip3 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+19 w" (width/2) " Center", Lock After Videos End ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAfterFS Choose" AfterFS " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTip4 hwndProtectionTip4 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Lock After Wake Up ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAfterWU Choose" AfterWU " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTip5 hwndProtectionTip5 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Security Logs ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vlogging Choose" logging " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTip6 hwndProtectionTip6 -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Animation ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAnimationWanted Choose" AnimationWanted " AltSubmit" , On|Off
	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Clock ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vClockWanted Choose" ClockWanted " AltSubmit" , On|Off
	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Key ›
	Gui, Add, Hotkey, % "x+" (width/4)-50 " w87 Center vassignedKeyLock" , %keyLock%

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+16 w" (width*0.64) " h33 gPrInfo hwndBut1 +Center", Info

	If(logging=1)
	{
		Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+2 w" (width*0.64) " h33 gSecurityLoggingLabel hwndBut2 +Center", Show Logs
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	}

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+10 w" (width*0.38) " h31 gprotectionbutton hwndBut3 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gdestroyprot hwndBut4 +Center",Cancel

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x009494, 0x009494, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(ProtectionTip1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTip2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTip3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTip4, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTip5, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTip6, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width , RS-Guard Settings
	FadeIn(ProtectionSettings)
return

destroyprot:
FadeOut(ProtectionSettings)
return

protectionbutton:
	Gui, Submit, NoHide

	MetRequirements:=True
	If BreakLoop=1
	{
		If !NewLockPw
		{
			Warning:="A password is needed."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If NewLockPw is not digit
		{
			Warning:="Password needs to be a number."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds=0
		{
			Warning:="Seconds need to be higher than 0."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds=""
		{
			Warning:="Please input seconds."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds is not number
		{
			Warning:="Seconds need to be a number."
			GoSub WarningGUI
			MetRequirements:=False
		}
		If(MetRequirements=0)
		{
			BreakLoop=0
			return
		}
	}

	If (NewLockPw!=LockPw && LockPw)
	{
		DontShowRS:=true
		AuthReq:=true
		cancelChange:=false
		GoSub LockNow
		WinWaitActive, ahk_id %ZPHWND%
		WinWaitNotActive, ahk_id %ZPHWND%
		If cancelChange
		{
			GuiControl,  ProtectionMenu:, NewLockPW, %LockPw%
			RSNotify("Canceled")
			return
		}
	}
	if !cancelChange
		LockPw:=NewLockPw

	LockPwHash:=Crypt.Encrypt.StrEncrypt(LockPw,"KktgC3l0wR",7,3)
	IniWrite, %LockPwHash%, settings.ini, settings, LockPwHash
	IniWrite, %assignedKeyLock%, settings.ini, settings, keyLock
	IniWrite, %BreakLoop%, settings.ini, settings, breakloop
	IniWrite, %ClockWanted%, settings.ini, settings, ClockWanted
	IniWrite, %AfterFS%, settings.ini, settings, AfterFS
	IniWrite, %AfterWU%, settings.ini, settings, AfterWU
	IniWrite, %logging%, settings.ini, settings, LoggingLockTimes
	IniWrite, %AnimationWanted%, settings.ini, settings, AnimationWanted
	If AnimationWanted!=1
		DontShowRS:=true
	else
		DontShowRS:=false

	FadeOut(ProtectionSettings)
	IniWrite, %seconds%, settings.ini, settings, seconds
	IniWrite, %delayseconds%, settings.ini, settings, delayseconds
	If BreakLoop=1
		Gosub Protection
	If (keyLock!="None" && keyLock!="" and keyLock!=assignedKeyLock)
		Hotkey, %keyLock%, LockNow, Off
	GoSub ButtonsLabel
return

;--------------------------------------------------------------------------------------------------------------

ScriptFunctions:
	width := 350
	Gui, Functions:New, +hwndSFunctions
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Color, 008383
	Gui, Margin, 0, 0
	Gui, Font, s11 cD0D0D0 Bold
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h67 Background1F2326 Disabled hwndHPROG"
	If AfterInstallation=1
	{
		Gui, Add, Text, % "x0 y1 w" width " h30 BackgroundTrans Center 0x200 gGuiMove vCaption", Welcome!
		Gui, Font, s8 c228a96, Tahoma
		Gui, Add, Text, % "x0 y+0 w" (width) " Center BackgroundTrans", Here are all the functions that are available to you.
		Gui, Add, Text, % "x0 y+2 w" (width) " Center BackgroundTrans", You can download extensions from our website.
		IniWrite, 0, settings.ini, settings, AfterInstallation
		AfterInstallation=0
	}
	else
	{
		Gui, Add, Text, % "x0 y0 w" width " h30 BackgroundTrans Center 0x200 gGuiMove vCaption", Features
		Gui, Font, s8 c228a96, Tahoma
		Gui, Add, Text, % "x-2 y+0 w" (width) " Center BackgroundTrans", Some hotkeys/features are configurable
		Gui, Add, Text, % "x-2 y+2 w" (width) " Center BackgroundTrans", Check "Configure Hotkeys"
	}
	Gui, Font, s10 c%lightc%, Tahoma
	Gui, Add, Text, % "x0 y+15 w" (width/2) " Center BackgroundTrans", Function
	Gui, Font, s10 c%lightc%, Tahoma
	Gui, Add, Text, % "x+2 w" (width/2) " Center BackgroundTrans", Keys

	Gui, Add, Text, % "x0 y+0 w" width " h3 Center ",
	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Speed Dial
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+0 w" (width/2) " vassignedKeyRSWebVar Center", %assignedKeyRSWeb%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Speed Dial a website
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyRSWeb2Var Center", %assignedKeyRSWeb% + 1/2/3...8
	
	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Play/Pause:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyPlayVar Center", %assignedKeyPlay%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Previous:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyPrevVar Center", %assignedKeyPrev%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Next:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyNextVar Center", %assignedKeyNext%

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Fast Search
	Gui, Font, s8 c%lightc%, Tahoma
	If FastSearchWanted=1
		Gui, Add, Text, % "x+1 w" (width/2) " Center vRAltVar", Right Alt
	else
		Gui, Add, Text, % "x+1 w" (width/2) " Center vRAltVar", Off

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x3 y+6 w" (width/2) " Center ", Minimize Current App:
	Gui, Font, s8 c%lightc%, Tahoma
	If AltMinimizeWanted=1
		Gui, Add, Text, % "x+0 w" (width/2) " Center vAltMinimizeVar",  Alt x 2
	Else
		Gui, Add, Text, % "x+0 w" (width/2) " Center vAltMinimizeVar",  Off

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+6 w" (width/2) " Center ", Volume Control:
	Gui, Font, s8 c%lightc%, Tahoma
	If VolumeOTWanted=1
		Gui, Add, Text, % "x+1 w" (width/2) " Center vVolumeOTVar", Scroll Over Tray
	Else
		Gui, Add, Text, % "x+1 w" (width/2) " Center vVolumeOTVar", Off

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Up:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyVolUpVar Center", %assignedKeyVolUp%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Down:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyVolDownVar Center", %assignedKeyVolDown%

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+12 w" (width/2) " Center ", Lock Now:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyLockVar Center", %assignedKeyLock%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Input Email:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", CapsLock x 2

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Input Password:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + CapsLock x 2

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Reload Script:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + Alt + R

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Suspend Script:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + Alt + S

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x008383, 0x008383, 0xEEEEEE]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+19 w" (width*0.64) " h36 gChangeHotkeys hwndBut1 +Center", Configure Hotkeys

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+2 w" (width*0.64) " h36 gAboutInfo hwndBut2 +Center", About Us

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+2 w" (width*0.64) " h36 gsubit +hwndBut3 +Default", Exit

	Gui, Add, Text, % "x7 y+10 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width " NA", Functions
	GoSub SetButtons
	FadeIn(SFunctions)
return

subit:
FadeOut(SFunctions)
 	Gui, Submit, NoHide
return

SetButtons:
	keysArray=assignedKeyRSWeb|assignedKeyPlay|assignedKeyPrev|assignedKeyNext|assignedKeyVolUp|assignedKeyVolDown|assignedKeyLock
	Loop, Parse, keysArray, `|
	{
		Replacement:=RegExReplace(%A_LoopField%, "[\^]", "Ctrl & ")
		Replacement:=RegExReplace(Replacement, "[!]", "Alt & ")
		Replacement:=RegExReplace(Replacement, "[+]", "Shift & ")
		Replacement:=RegExReplace(Replacement, "[&]", "+")
		If % %A_LoopField%!="None"
			GuiControl, Functions:, %A_LoopField%Var, % Replacement
		else
			GuiControl, Functions:, %A_LoopField%Var, Off
	}

	If assignedKeyRSWeb!=None
		GuiControl, Functions:, assignedKeyRSWeb2Var, %assignedKeyRSWeb% + 1/2/3...8
	else
		GuiControl, Functions:, assignedKeyRSWeb2Var, Off
return

;--------------------------------------------------------------------------------------------------------------

ChangeHotkeys:

	keysArray=keyRSWeb|keyPlay|keyPrev|keyNext|keyVolUp|KeyVolDown|keyLock
	Loop, Parse, keysArray, `|
	{
		IniWrite, % assigned%A_LoopField%, settings.ini, settings, %A_LoopField%
		IniRead, %A_LoopField%, settings.ini, settings, %A_LoopField%
	}
	
	width := 280
	Gui, ChangeHotkeys:New, +hwndChangeHotkeys
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y8 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Change Hotkeys

	Gui, Color, 2e2e2e, 333333
	Gui, Font, s8, Tahoma

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+25 w" (width) " Center ", Press Delete on a hotkey to disable it
	Gui, Add, Text, % "x0 y+20 w" (width/2) " vLabelSP Center ", Speed Dial
	Gui, Add, Hotkey, % "x+30 w72 Center gRSWebKeyModifiersCheck vassignedKeyRSWeb" , %keyRSWeb%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Play/Pause
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyPlay" , %keyPlay%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Previous
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyPrev" , %keyPrev%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Next
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyNext" , %keyNext%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Up
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyVolUp" , %keyVolUp%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Down
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyVolDown" , %keyVolDown%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Lock
	Gui, Add, Hotkey, % "x+30 w72 Center vassignedKeyLock" , %keyLock%

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+25 w" (width*0.38) " h31 gchangebutton hwndBut1 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gchangeclose hwndBut2 +Center",Cancel

	Gui, Add, Text, % "x+1 h44 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, w%width%, Change Hotkeys
	GuiControl, Focus, LabelSP
	FadeIn(ChangeHotkeys)
return

ChangeButton:
	Gui, Submit, NoHide
	keysArray=keyRSWeb|keyPlay|keyPrev|keyNext|keyVolUp|KeyVolDown|keyLock
	Loop, Parse, keysArray, `|
	{
		IniWrite, % assigned%A_LoopField%, settings.ini, settings, %A_LoopField%
		If (%A_LoopField%!="None" && %A_LoopField%!="" and %A_LoopField%!=assigned%A_LoopField%)
			Hotkey, % %A_LoopField%, Off
	}
	GoSub ButtonsLabel
ChangeClose:
	GoSub SetButtons
	FadeOut(ChangeHotkeys)
return

RSWebKeyModifiersCheck:    ; Prevents the HotKey box from accepting any combination of the Ctrl, Alt, and Shift keys. ; Credit where it is due: Shadowpheonix at autohotkey.com/boards/viewtopic.php?t=19518
	Gui, Submit, NoHide
	assignedKeyRSWeb := RegExReplace(assignedKeyRSWeb, "[!^+]*(.*)", "$1")
	GuiControl, ChangeHotkeys:, assignedKeyRSWeb, %assignedKeyRSWeb%
Return
;--------------------------------------------------------------------------------------------------------------

AboutInfo:
	IniRead, InstalledVersion, build.ini, build, Version, 1.0
	IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
	width=260
	Gui, AboutInfo:New, +hwndAboutInfo +ToolWindow
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2e2e2e
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h30 Background272727 Disabled hwndHPROG"
	Gui, Add, Text, x0 y6 w%width% Center BackgroundTrans +0x200 c%darkerc%, About

	Gui, Font, s9 c%darkerc%, Tahoma
	Gui, Add, Text, % "x5 y+28 w" (width/2) " Center ", Version
	Gui, Font, c%lightc%, Tahoma
	InVersionVar:= (InstalledVersion=1.0) ? "Unknown" : "v" . InstalledVersion
	Gui, Add, Text, % "x+0 w" (width/2.5) " Center", %InVersionVar%
	Gui, Font, c%darkerc%, Tahoma
	Gui, Add, Text, % "x5 y+12 w" (width/2) " Center ", Newest
	Gui, Font, c%lightc%, Tahoma
	UpVersionVar:= (UpdateVersion=1.0) ? "Retrieving" : "v" . UpdateVersion
	Gui, Add, Text, % "x+0 w" (width/2.5) " vUpVersionVar Center", %UpVersionVar%
	Gui, Font, c%darkerc%, Tahoma
	Gui, Add, Text, % "x5 y+25 w" (width/2) " Center ", Creator
	Gui, Font, c%lightc%, Tahoma
	Gui, Add, Text, % "x+0 w" (width/2.5) " Center", Riyusso
	Gui, Font, c%darkerc%, Tahoma
	Gui, Add, Text, % "x5 y+12 w" (width/2) " Center ", Tester
	Gui, Font, c%lightc%, Tahoma
	Gui, Add, Text, % "x+0 w" (width/2.5) " Center", physic
	Gui, Font, c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+25 w" (width) " Center ", Website
	Gui, Font, c%lightc%, Tahoma
	Gui, Add, Text, % "x0 w" (width) " y+8 Center", riyusso.github.io
	Gui, Font, c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+25 w" (width) " Center ", Email
	Gui, Font, c%lightc%, Tahoma
	Gui, Add, Text, % "x0 w" (width) " y+8 Center", Riyusso@gmx.us

	Gui, Font, s10 Bold, Tahoma
	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " w" (width*0.64) "  y+25 h33 gAboutExit +hwndBut1 +Default", Exit
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x7 y+10 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6", ahk_id %AboutInfo%
	Gui, Show, w%width% h%H%, About
	FadeIn(AboutInfo)
	WinSet, Transparent, 247

	if lastUpdateCheck>=3600000
		GoSub GetLatestVersion

	IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
	UpVersionVar:= (UpdateVersion=1.0) ? "Offline" : "v" . UpdateVersion
	GuiControl, AboutInfo:, UpVersionVar, %UpVersionVar%
return

AboutExit:
	FadeOut(AboutInfo)
return

;--------------------------------------------------------------------------------------------------------------

MenuInit:
IfExist OptionsIcon.ico
{
	Menu, Tray, Icon
	Menu, TRAY, Icon, OptionsIcon.ico
}
Else
{
	FileInstall, Base/OptionsIcon.ico, %A_MyDocuments%\%ScriptName%\OptionsIcon.ico, 1
	Menu, Tray, Icon
	Menu, TRAY, Icon, OptionsIcon.ico
}
If A_IsCompiled
	Menu, Tray, Tip, %ScriptName%. Make everyday tasks effortless.
Else
	Menu, Tray, Tip, Uncompiled
Menu, Tray, NoStandard
Menu, Tray, ADD, Menu, DefaultMenu
Menu, Tray, ADD, Reload, mnuScriptReload
Menu, Tray, ADD, Quit, mnuExit
Menu, Tray, Default, Menu
Menu Tray, Click, 1           ; Enable single click action on tray
Return

mnuScriptReload:
	IntentReload=1
	Reload
Return

mnuUninstall:
	FadeOut(UninstallPrompt)
	FadeOut(OtherHWND)
	FadeOut(ScriptOptions)
	FadeOut(DefaultHWND)
	RSNotify("Uninstalling")
	Loop, Files, *.ahk
	{
		SplitPath, A_LoopFileLongPath,,,, PluginName

		If RegExMatch(PluginName, "\W")
		{
			PluginName:=StrReplace(PluginName, A_Space, "_")
			PluginName := RegExReplace(PluginName, "\W")
			FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
		}

		IfWinExist, % "ahk_pid" PID%PluginName%
			WinKill, % "ahk_pid" PID%PluginName%
	}
	Sleep 2000
	SplitPath, A_Scriptname, , , , OutNameNoExt
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk
	StartMenuFile=%A_StartMenu%\Programs\%ScriptName%.lnk
	MsgBox, %StartMenuFile%
	FileDelete, %StartMenuFile%
	FileDelete, %LinkFile%
	Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript, , HIDE
	FileInstall, Base\uninstaller.exe, %A_Temp%\uninstaller.exe, 1
	Run, %A_Temp%\uninstaller.exe,, HIDE
	ExitApp
return

SuspendScriptToggle:
Suspend, Toggle
Loop, Files, *.ahk
{
	SplitPath, A_LoopFileLongPath,,,, PluginName

	If RegExMatch(PluginName, "\W")
	{
		PluginName:=StrReplace(PluginName, A_Space, "_")
		PluginName := RegExReplace(PluginName, "\W")
		FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
	}

	IfWinExist, % "ahk_pid" PID%PluginName%
		PostMessage, 0x111, 65305,,, %PluginName%.ahk - AutoHotkey ; Suspend plugins.
}
If A_IsSuspended
{
	Menu, Tray, Icon
	Menu, TRAY, Icon, RSStopped.ico,,1
	If !SuspendedByFullScreen
	RSNotify("Suspended")
}
If !A_IsSuspended
{
	Menu, Tray, Icon
	Menu, TRAY, Icon, OptionsIcon.ico,,1
	If !SuspendedByFullScreen
	RSNotify("Released")
}
return

mnuExit:
	FadeOut(DefaultHWND)
	GoSub RSRunScript
	sleep 1000
	GoSub ExitAppL
Return

ExitAppL:
	If IntentReload=1
		IniWrite, %IntentReload%, settings.ini, settings, Reloaded
	Loop, Files, *.ahk
	{
		SplitPath, A_LoopFileLongPath,,,, PluginName
		
		If RegExMatch(PluginName, "\W")
		{
			PluginName:=StrReplace(PluginName, A_Space, "_")
			PluginName := RegExReplace(PluginName, "\W")
			FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
		}

		IfWinExist, % "ahk_pid" PID%PluginName%
			WinKill, % "ahk_pid" PID%PluginName%
	}
	ExitApp
return

DefaultMenu:
	if(!DefaultFader)
	{
		FadeOut(DefaultHWND)
		Gui, DefaultMenu:New, +hwndDefaultHWND
		Gui, +LastFound +AlwaysOnTop -Caption +ToolWindow
		WinSet, Transparent, 0
		Gui, Margin, 0, 0
		Gui, Font,  cFFFFFF Bold, Segoe UI
		Gui, Color, 232323

		If (A_ScreenWidth<2000)
		{
			amultiplier=1
			zfont=13
		}
		If (A_ScreenWidth<1800)
		{
			amultiplier=1
			zfont=12
		}
		If (A_ScreenWidth<1600)
		{
			amultiplier=0.92
			zfont=11
		}
		If (A_ScreenWidth<1400)
		{
			amultiplier=0.87
			zfont=11
		}
		If (A_ScreenWidth<1050)
		{
			amultiplier=0.80
			zfont=10
		}

		Gui, Font, s%zfont% cFFFFFF Bold q5
		guiw:=880*amultiplier
		guih:=56*amultiplier
		buth:=(guih)+2
		butw:=((guiw-30)/8)
		guipos:=A_ScreenHeight-164

		Opt1 := [6, 0x232323, 0x232323, "White"]
		Opt2 := [ , 0x292929, 0x282828, 0xffffff]
		Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

		Gui, Add, Button, % "x0 y-2 h" buth " w" butw+9 " gProtectSwitch hwndBut1 +Center", Protection

		Gui, Add, Button, % "x+0 h" buth " w" butw " gSuspendScriptToggle hwndBut2 +Center", Suspend

		Gui, Add, Button, % "x+0 h" buth " w" butw " gmnuScriptReload hwndBut3 +Center", Reload

		Gui, Add, Button, % "x+0 h" buth " w" butw " gLockNow hwndBut4 +Center",  Lock

		Gui, Add, Button, % "x+0 y-2 h" buth " w" butw+9 " gUpdatePrompt hwndBut5 +Center", Update

		Gui, Add, Button, % "x+0 h" buth " w" butw+7 " gScriptFunctions hwndBut6 +Center", Features

		Gui, Add, Button, % "x+0 h" buth " w" butw " gsettings hwndBut7 +Center", Settings

		Gui, Add, Button, % "x+0 h" buth " w" butw-37 " gmnuExit hwndBut8 +Center",  Quit

		Gui, Add, Button, % "x+0 h" buth " w53 gExitDefMenu hwndBut9", ×
		ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But5, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But6, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But7, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But8, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But9, Opt1, Opt2, "", Opt4)
		WinSet, Region, % "0-0 w" guiw*dpi " h" guih*dpi " r50-50", ahk_id %DefaultHWND%
		Gui, Show, h%guih% w%guiw% y%guipos% NoActivate, Menu
		FadeIn(DefaultHWND)

		if lastUpdateCheck>=3600000
			GoSub GetLatestVersion

		IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
		IniRead, InstalledVersion, build.ini, build, Version, 1.0
		IniRead, PromptVersion, build.ini, build, PromptVersion

		If % VersionCompare(UpdateVersion, InstalledVersion)=1
		{		
			If(PromptVersion!=UpdateVersion)
				GoSub UpdatePrompt
			else
				RSNotify("Update Available")
		}

		DefaultFader:=true
	}
Return

ExitDefMenu:
FadeOut(DefaultHWND)
DefaultFader:=false
return

;--------------------------------------------------------------------------------------------------------------

SecurityLoggingLabel:
	Array := Object()
	Loop, Read, log.txt ; This loop retrieves each line from the file, one at a time.
	{
		Array.Insert(A_LoopReadLine)
	}
	elcount:=Array.MaxIndex() ; get the count of the lines in the log file
	calccount:=elcount-20 ; get the index of the last 20

	width :=330
	Gui, SecLogs:New, +hwndSecLogs
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"

	Loop, 20
	{
		element:=Array[calccount+A_Index]
		if(A_Index=1 and element="")
		continue
		Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", %element%
	}

	Gui, Color, 2e2e2e
	Gui, Font, s11 cFFFFFF Bold, Segoe UI

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+22 w" (width*0.64) " gdestroySecLogs hwndBut1 +Center +Default", Close
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , Security Logs
	FadeIn(SecLogs)
return

destroySecLogs:
FadeOut(SecLogs)
return

;--------------------------------------------------------------------------------------------------------------

WarningGUI:
	width :=220
	Gui, WarningGUI:New, +hwndWarningGUI
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cRed Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"

	If(ProtectionWarning)
	{
		Gui, Add, Text, % "x0 y15 w" width " r1 BackgroundTrans Center 0x200 gGuiFade", Protection : Error
		Gui, Font, s8 cFFFFFF Bold, Tahoma
		Gui, Add, Text, % "x0 y+20 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", For the Protection to work:
		Gui, Add, Text, % "x0 y+0 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0 h5",
		ProtectionWarning=0
	}
	Gui, Font, s8 cFFFFFF Bold, Tahoma

	If(Warning)
		Gui, Add, Text, % "x0 y+5 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", %Warning%

	Loop, 10
	If(Warning%A_Index%)
	{
		Gui, Add, Text, % "x0 y+6 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", % Warning%A_Index%
		Warning%A_Index%=
	}

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , Warning
	FadeIn(WarningGUI)
	If(Warning) ; If it's just a simple warning (Warning variable is used)
	{
		SetTimer, FadeOutWarning, -1800
		Warning=
	}
	else ; If it's an important warning (Warning1-10 variables are used)
		SetTimer, FadeOutWarning, -8500

return

FadeOutWarning:
	FadeOut(WarningGUI)
return

;--------------------------------------------------------------------------------------------------------------

PrInfo:
	width :=330
	Gui, PrInfo:New, +hwndPrInfo
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y16 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", RS-Guard is designed to protect your PC.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", It is going to lock the computer after
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", the amount of time you have set.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  --- How to use it ---
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Set a password.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Wait or press the lock button.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", --- Requirements ---
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", The password needs to be a number.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", You MUST set seconds and a password.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  --- What some settings do ---
	Gui, Add, Text, % "x0 y+10 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Protected/Unprotected Dropdown -
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0",  Toggles whether RS-Guard will lock the PC
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", after the amount of time or not.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", You can still lock it with the select key
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+10 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Lock After Videos End -
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", This option controls whether the PC
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", will lock itself after you exit full screen.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", This is useful when you are watching a movie.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+10 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", - Clock -
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", Controls whether a clock is displayed
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", on the lock screen.

		Gui, Color, 2e2e2e
		Gui, Font, s11 cFFFFFF Bold, Tahoma

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+18 w" (width*0.64) " gdestroyPrInfo hwndBut1 +Center +Default", Got it
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , RS-Guard Settings
	FadeIn(PrInfo)

return

destroyPrInfo:
	FadeOut(PrInfo)
return

;--------------------------------------------------------------------------------------------------------------

AdminPrompt:
	width=144
	height=66
	Gui, AdminPrompt:New, +hwndAdminPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 008383
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96, Are you an admin?

	Gui, Add, Button, % "x10 y30 w" Width/2-10 " +default gRunAsAdmin hwndBut1 +Center", Yeah
	Gui, Add, Button, % "x+0 y30 w" Width/2-10 " gNotAnAdmin hwndBut2 +Center", Nope

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %AdminPrompt%
	Gui, Show, w%width% h%height% , Are you an admin?
	FadeIn(AdminPrompt)
return

;--------------------------------------------------------------------------------------------------------------

Authorization:
	If WinActive("ahk_id" . Auth)
		return

	Gui, Auth:New, +hwndAuth
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2b2b2a, 2b2b2a
	Gui, Font, s10 Bold c00afaf, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w200 h26 Background1f1f1f Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w200 Center BackgroundTrans +0x200 cb1b1b1, Please authorize yourself.

	Gui, Font, w700 s12 c00afaf, Segoe UI Black
	Gui, Add, Edit, % "x0 y+13 w155 h25 hwndEdit265 vorigpass -E0x200 +Center -VScroll +password",

	Gui, Font, w700 s11 ceeeeee, Segoe UI Black
	Opt1 := [6, 0x2b2b2a, 0x2b2b2a, 0xD0D0D0]
	Opt2 := [ , 0x2b2b2a, 0x2b2b2a, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, x+0 w45 h25 +default gAuthorize hwndBut1 +Center, Go
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	scaledw:=200
	scaledh:=70
	SHAutoComplete(Edit265)
	WinSet, Region, % "0-0 w" scaledw*dpi " h" scaledh*dpi " r12-12", ahk_id %Auth%
	; NoActivate fixes weird bug with not being able to switch language
	Gui, Show, w%scaledw% h%scaledh% NoActivate, Authorization
	WinActivate	
	; -----------------
	FadeIn(Auth)
	SetTimer, CheckIfAuthInactive, 200
return

Authorize:
	Gui, Submit, NoHide
	If (origpass=password and StrLen(origpass)>0)
	{
		FadeOut(Auth)
		Authorized:=true
		SetTimer, CheckIfAuthInactive, Off
		WinWaitNotActive, ahk_id %Auth%,,15
		{
			Sleep 20
			WinActivate, ahk_id %activeWindowForPassword%
			SendInput {Raw}%password%
		}
		SetTimer, AuthExpirationCheck, 2000
		If PasswordExpiration=1
			RSNotify("Secure")
		else if PasswordExpiration=2
		{
			SetTimer, AuthExpirationCheck, Off
			RSNotify("No Expiration")
		}
		else
		{
			GoSub ExpirationPrompt
			SetTimer, KeepDefaultExpiration, -15000
		}
		StartTick:=A_TickCount
		FadeOut(Auth)
		return
	}
	Else
	{
		GuiControl, Auth:, origpass
		RSNotify("Not Authorized")
	}
return

ExpirationPrompt:
	width=235
	height=123
	Gui, ExpirationPrompt:New, +hwndExpirationPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2b2b2a
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x2b2b2a, 0x2b2b2a, "White"]
	Opt2 := [ , 0x3b3b3a, 0x3b3b3a, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y6 w%width% Center BackgroundTrans +0x200 ceeeeee, Authorization ends after?
	Gui, Font, s10 Bold ceeeeee, Tahoma
	Gui, Add, Button, x0 y+8 w%width% h45 +default gKeepDefaultExpiration hwndBut1 +Center, 6 minutes of inactivity

	Gui, Add, Button, x0 y+0 w%width% h47 gNoAuthExpiration hwndBut2 +Center, No expiration

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r12-12", ahk_id %ExpirationPrompt%
	Gui, Show, % "x" (A_ScreenWidth)-width-50 "y " (A_ScreenHeight-height-80) " w" width " h" height " NoActivate",
	FadeIn(ExpirationPrompt)
return

NoAuthExpiration:
SetTimer, AuthExpirationCheck, Off
ExpirationPromptGuiEscape:
KeepDefaultExpiration:
IfWinExist, ahk_id %ExpirationPrompt%
	FadeOut(ExpirationPrompt)
return

AuthExpirationCheck:
	If (A_TimeIdle > 360000) or (A_TickCount - StartTick > 7500) ; Authorization will expire when computer goes to sleep or when idle for 6 minutes.
	{
		Authorized:=false
		SetTimer, AuthExpirationCheck, Off
	}
	StartTick:=A_TickCount
return

CheckIfAuthInactive:
	IfWinNotActive, ahk_id %Auth%
	{
		SetTimer, CheckIfAuthInactive, Off
		FadeOut(Auth)
	}
return

AuthExpire:
	Authorized:=false
	SetTimer, AuthExpirationCheck, Off
return

AuthGuiEscape:
	FadeOut(Auth)
return

;--------------------------------------------------------------------------------------------------------------

UpdatePrompt:
If StillDownloading
{
	RSNotify("Still Downloading")
	return
}
GoSub GetLatestVersion
IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
IniRead, InstalledVersion, build.ini, build, Version, 1.0

If % VersionCompare(UpdateVersion, InstalledVersion)=1
{
	width=150
	height=66
	Gui, UpdatePrompt:New, +hwndUpdatePrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 008383
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96, Update to v%UpdateVersion%?

	Gui, Add, Button, x8 y30 w65 +default gUpdate hwndButUp1 +Center, Yeah
	Gui, Add, Button, x+5 y30 w65 gNoUpdate hwndButUp2 +Center, Nope

	ImageButton.Create(ButUp1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ButUp2, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %UpdatePrompt%
	Gui, Show, w%width% h%height% , Update Prompt
	FadeIn(UpdatePrompt)
}
Else
	RSNotify("No new versions")
return

;--------------------------------------------------------------------------------------------------------------

UninstallPrompt:
	width=145
	height=126
	Gui, UninstallPrompt:New, +hwndUninstallPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 008383
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x008383, 0x008383, "White"]
	Opt2 := [ , 0x008383, 0x00a3a3, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96, Select your choice
	Gui, Add, Button, x0 y+10 w%width% +default gmnuUninstall hwndBut1 +Center, Uninstall

	Gui, Add, Button, x0 y+2 w%width% gReinstall hwndBut2 +Center, Repair

	Gui, Add, Button, x0 y+2 w%width% gCancelUninstall  hwndBut3 +Center, Cancel

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %UninstallPrompt%
	Gui, Show, w%width% h%height% , Update Prompt
	FadeIn(UninstallPrompt)
return

UninstallPromptGuiEscape:
CancelUninstall:
	FadeOut(UninstallPrompt)
return