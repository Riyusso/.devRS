#NoEnv
#NoTrayIcon
FileInstall, build.ini, install.ini
IniRead, UpdateVersion, install.ini, build, Version
FileDelete, install.ini
SendMode Input
ScriptName=.devRS
global dpi:=DpiFactor()

IfExist, %A_MyDocuments%\%ScriptName%\%ScriptName%.exe
{
	SetWorkingDir %A_MyDocuments%\%scriptname%
	IniRead, InstalledVersion, build.ini, build, Version, 1.0
	IfNotExist, %A_MyDocuments%\%ScriptName%\build.ini
		InstalledVersion=1.0

	If % VersionCompare(UpdateVersion, InstalledVersion)=1
		GoSub UpdateIt

	IfExist, % A_MyDocuments "\" scriptname "\" scriptname ".exe"
	{
		Run, % A_MyDocuments "\" scriptname "\" scriptname ".exe"
		If(IsUpdated)
			RSNotify("Updated")
		Sleep 1750
	}
}
else
{
	FileCreateDir, %A_MyDocuments%\%ScriptName%
	SetWorkingDir %A_MyDocuments%\%scriptname%
	FileInstall, Base.exe, %A_MyDocuments%\%ScriptName%\%ScriptName%.exe, 1
	Sleep 1250
	IfExist, % A_MyDocuments "\" scriptname "\" scriptname ".exe"
	Run, % A_MyDocuments "\" scriptname "\" scriptname ".exe"
	IniWrite, %UpdateVersion%, build.ini, build, Version
	ExitApp
}
ExitApp
return

UpdateIt:
		IniWrite, 1, build.ini, build, ExitVar
		RSNotify("Updating")
		Sleep 1250
		FileInstall, Base.exe, %A_MyDocuments%\%ScriptName%\%ScriptName%.exe, 1
		IniWrite, 0, build.ini, build, ExitVar
		IniWrite, %UpdateVersion%, build.ini, build, Version
		IsUpdated:=true
		Sleep 1250
return

DPIFactor()
{
RegRead, DPI_value, HKEY_CURRENT_USER, Control Panel\Desktop\WindowMetrics, AppliedDPI
; the reg key was not found - it means default settings
; 96 is the default font size setting
if (errorlevel=1) OR (DPI_value=96 )
	return 1
else
	Return  DPI_Value/96
}

; VersionCompare function by boiler at ahkscript.org
; Returns 1 if version1 is more recent, 2 if version 2 is more recent, 0 if they are the same.
VersionCompare(version1, version2)
{
	StringSplit, verA, version1, .
	StringSplit, verB, version2, .
	Loop, % (verA0> verB0 ? verA0 : verB0)
	{
		if (verA0 < A_Index)
			verA%A_Index% := "0"
		if (verB0 < A_Index)
			verB%A_Index% := "0"
		if (verA%A_Index% > verB%A_Index%)
			return 1
		if (verB%A_Index% > verA%A_Index%)
			return 2
	}
	return 0
}

#Include Libraries\RSNotify.lib